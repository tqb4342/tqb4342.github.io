<!DOCTYPE html>
<html>
<meta  lang="zh-CN" >
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
    content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="theme-color" content="#fff" id="theme-color">
  <link rel="icon" href="/img/logo.jpg">
  <title>谭庆波的博客</title>
  
  
  <meta property="og:title" content="用winpcap测试自己的通信协议（一）">
  
  
  <meta property="og:url" content="http://tanqingbo.cn/2019/10/06/%E7%94%A8winpcap%E6%B5%8B%E8%AF%95%E8%87%AA%E5%B7%B1%E7%9A%84%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE%EF%BC%88%E4%B8%80%EF%BC%89/index.html">
  
  
  <meta property="og:img" content="/img/logo.jpg">
  
  
  <meta property="og:img" content="学习总结  思考感悟  知识管理">
  
  
  <meta property="og:type" content="article">
  <meta property="og:article:published_time" content="2019-10-06">
  <meta property="og:article:modified_time" content="2019-10-07">
  <meta property="og:article:author" content="谭庆波">
  
  
  
  
  
  
  
  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-178024758-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-178024758-1');
</script>
  
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?d87293651eefff721c898f38338ea3a8";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

  
  <script>
    // control reverse button
    var reverseDarkList = {
      dark: 'light',
      light: 'dark'
    };
    var themeColor = {
      dark: '#1c1c1e',
      light: '#fff'
    }
    // get the data of css prefers-color-scheme
    var getCssMediaQuery = function() {
      return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    };
    // reverse current darkmode setting function
    var reverseDarkModeSetting = function() {
      var setting = localStorage.getItem('user-color-scheme');
      if(reverseDarkList[setting]) {
        setting = reverseDarkList[setting];
      } else if(setting === null) {
        setting = reverseDarkList[getCssMediaQuery()];
      } else {
        return;
      }
      localStorage.setItem('user-color-scheme', setting);
      return setting;
    };
    // apply current darkmode setting
    var setDarkmode = function(mode) {
      var setting = mode || localStorage.getItem('user-color-scheme');
      if(setting === getCssMediaQuery()) {
        document.documentElement.removeAttribute('data-user-color-scheme');
        localStorage.removeItem('user-color-scheme');
        document.getElementById('theme-color').content = themeColor[setting];
      } else if(reverseDarkList[setting]) {
        document.documentElement.setAttribute('data-user-color-scheme', setting);
        document.getElementById('theme-color').content = themeColor[setting];
      } else {
        document.documentElement.removeAttribute('data-user-color-scheme');
        localStorage.removeItem('user-color-scheme');
        document.getElementById('theme-color').content = themeColor[getCssMediaQuery()];
      }
    };
    setDarkmode();
  </script>
  <script>
    function loadScript(url, cb) {
      var script = document.createElement('script');
      script.src = url;
      if (cb) script.onload = cb;
      script.async = true;
      document.body.appendChild(script);
    }
  </script>
  
  <link rel="preload" href="//at.alicdn.com/t/font_1946621_f7g5jnuftcf.css" as="style" >
  <link rel="preload" href="//at.alicdn.com/t/font_1952792_89b4ac4k4up.css" as="style" >
  
  <link rel="preload" href="//cdn.jsdelivr.net/npm/fslightbox@3.1.0/index.min.js" as="script">
  
  
  <link rel="preload" href="/js/lib/lozad.min.js" as="script">
  
  
  
  
  
  <link rel="prefetch" href="//cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-svg.js" as="script">
  
  
  
  
  
<link rel="stylesheet" href="/css/main.css">

  
  
<link rel="stylesheet" href="//at.alicdn.com/t/font_1946621_f7g5jnuftcf.css">

  
  
<link rel="stylesheet" href="//at.alicdn.com/t/font_1952792_89b4ac4k4up.css">

  
  
  
<meta name="generator" content="Hexo 5.1.1"></head>


<body>
  <div class="wrapper">
    
    <nav class="navbar">
  <div class="navbar-logo">
    <span class="navbar-logo-main">
      
      <img class="navbar-logo-img" src="/img/logo.jpg">
      
      <span class="navbar-logo-dsc">谭庆波的博客</span>
    </span>
  </div>
  <div class="navbar-menu">
    
    <a href="/" class="navbar-menu-item">
    
    首页
    
    </a>
    
    <a href="/archives" class="navbar-menu-item">
    
    归档
    
    </a>
    
    <a href="http://tanqingbo.cn/categories/%E8%B5%84%E6%BA%90%E5%88%86%E4%BA%AB/" class="navbar-menu-item">
    
    资源分享
    
    </a>
    
    <a href="/about" class="navbar-menu-item">
    
    关于我
    
    </a>
    
    <a href="/categories" class="navbar-menu-item">
    
    分类
    
    </a>
    
    <a href="/links" class="navbar-menu-item">
    
    友链
    
    </a>
    
    <a class="navbar-menu-item darknavbar" id="dark"><i class="iconfont icon-weather"></i></a>
    <a class="navbar-menu-item searchnavbar" id="search"><i class="iconfont icon-search" style="font-size: 1.2rem; font-weight: 400;"></i></a>
  </div>
</nav>
    
    <div id="local-search" style="display: none;">
      <input class="navbar-menu-item" id="search-input" placeholder="请输入搜索内容...">
      <div id="search-content"></div>
    </div>
    
    <div class="section-wrap">
      <div class="container">
        <div class="columns">
          <main class="main-column">
<article class="card card-content">
  <header>
    <h1 class="post-title">
      用winpcap测试自己的通信协议（一）
    </h1>
  </header>
  <div class="post-meta post-show-meta">
    <time datetime="2019-10-06T08:49:18.000Z" style="display: flex; align-items: center;">
      <i class="iconfont icon-calendar" style="margin-right: 2px;"></i>
      <span>2019-10-06</span>
    </time>
    
    <span class="dot"></span>
    
    <a href="/categories/转载/" class="post-meta-link">转载</a>
    
    
    
    <span class="dot"></span>
    <span>4k 字</span>
    
  </div>
  
  </header>
  <div id="section" class="post-content">
    <ul>
<li><a target="_blank" rel="noopener" href="http://www.bewindoweb.com/211.html">http://www.bewindoweb.com/211.html</a><div class="card-article-text"><h1>一、通信协议的设计</h1><p>说到通信，我们肯定会想到OSI七层模型，想到TCP/IP，想到Socket。但是如果我们需要直接和物理设备通信，尤其是对实时性、安全性要求较高的时候，采用在数据链路层发送自己设计的裸包的方法是最好不过的了：</p><p>第一，安全性可控。自己设计的通信协议当然可以控制想要加密什么东西了。</p><p>第二，实时性。不需要经过高层的封包解包，直接向MAC地址发送裸包。</p><p>第三，也是最重要的，可裁剪。我们可以裁剪掉不需要的功能，增加需要的功能，这对于有内存闪存大小限制的嵌入式设备是很有意义的。</p><p>那么，该如何去设计这个通信协议呢？最简单的协议可以考虑这些内容：</p><table border="0" width="100%" cellpadding="0" cellspacing="0"><tbody><tr><th>序号</th><th>协议字段名</th><th>详细描述</th></tr><tr><td>&nbsp;1</td><td>协议标识</td><td>&nbsp;标记这个包是用的你的协议</td></tr><tr><td>&nbsp;2</td><td>协议版本</td><td>&nbsp;当协议有多个版本后，可以协调兼容问题<br></td></tr><tr><td>&nbsp;3</td><td>包类型</td><td>&nbsp;握手包、心跳包、数据包、断开包</td></tr><tr><td>&nbsp;4</td><td>包序号</td><td>&nbsp;发送者设定序号，接受者回复同样的号</td></tr><tr><td>&nbsp;5</td><td>数据长度</td><td>&nbsp;数据字段有多少字节</td></tr><tr><td>&nbsp;6</td><td>数据</td><td>&nbsp;要传输的数据，可以为空&nbsp;</td></tr><tr><td>&nbsp;7</td><td>校验和&nbsp;</td><td>&nbsp;校验包在传输过程中是否发生了错误</td></tr></tbody></table><p>当然，更深层次的协议可以去设计错误码、重传、分片、加密、压缩、FLAG字段、透传token等等，甚至还需要考虑各种开源代码是否可以使用（如果你不想开源的话，使用MIT License的代码是很好的选择）。</p><p>简单包中的1~4可以看做传说中的包头（Header），我们定义自己的一个简单通信协议，称为BTP(BWB Transport Protocol)：</p><p></p><p><img class="zoompic" src="http://cdn.bewindoweb.com/uploadpic/fc3ef3057163efc4bb5a359d5c85b087.png" style="max-width:100%;"></p><p>其中：</p><table border="0" width="100%" cellpadding="0" cellspacing="0"><tbody><tr><th>序号</th><th>BTP字段名</th><th>说明</th></tr><tr><td>&nbsp;1</td><td>协议标识</td><td>&nbsp;0x42（大写的'B'）</td></tr><tr><td>&nbsp;2</td><td>协议版本</td><td>&nbsp;0x01（1.0版本）</td></tr><tr><td>&nbsp;3</td><td>包类型</td><td>&nbsp;握手请求包：0x01<br>&nbsp;握手响应包：0x02<br>&nbsp;心跳请求包：0x03<br>&nbsp;心跳响应包：0x04<br>&nbsp;数据包：0x05<br>&nbsp;断开请求包：0x06<br>&nbsp;断开响应包：0x07</td></tr><tr><td>&nbsp;4</td><td>包序号</td><td>&nbsp;0x00~0xFF循环使用</td></tr><tr><td>&nbsp;5</td><td>数据长度</td><td>&nbsp;0x0000~0xFFFF</td></tr><tr><td>&nbsp;6</td><td>数据</td><td>&nbsp;要传输的数据，可以为空&nbsp;</td></tr><tr><td>&nbsp;7</td><td>校验和&nbsp;</td><td>&nbsp;采用经典的CRC32</td></tr></tbody></table><p>一个简单BTP传输协议就设计好啦。</p><h1>二、使用winpcap进行简单收发包测试</h1><h2>实验工具和平台</h2><p>操作系统：windows 8 / VMware14（windows xp sp3）</p><p>开发软件：Visual Studio 2013 / Wireshark 2.6.2（可以运行在windows 8 上） / Wireshark&nbsp; 1.4.9（可以运行在windows xp上）[<a href="https://pan.baidu.com/s/16wmWk0y_M6I5JyyOWfQbmA" target="_blank">百度网盘下载</a>（密码：bclc）]</p><p>插件：WinPcap 4.1.2 源码包&nbsp; [<a href="https://pan.baidu.com/s/1lkz3-kc-iWRSnvyqfFlzMw" target="_blank">百度网盘下载</a>（密码：a03g）]&nbsp;</p><h2>实验拓扑</h2><p><img class="zoompic" src="http://cdn.bewindoweb.com/uploadpic/a0ddd5e964e522f452afdf7e63c0d380.png" style="max-width:100%;"></p><p>PA端是真实的电脑，PB端是vmware开的windows xp虚拟机，虚拟机网络连接方式选择NAT模式。这样，主机上的VMnet8 Adapter就能够和虚拟机的虚拟网卡处于同一个网段中来通信了。</p><h2>收发包基础环境搭建</h2><p>【PA发包】</p><p>1、搭建Visual Studio可用环境</p><p>（1）文件→新建→项目→Visual C++空项目→命名为<code>BTPsender</code></p><p>（2）右键→添加→新建项：新建一个头文件<code>BTPsender.h</code>和源文件<code>BTPsender.c</code></p><p><img class="zoompic" src="http://cdn.bewindoweb.com/uploadpic/34ef07c73472ddf92e861a8dce50e608.png" style="max-width:100%;"></p><p>（3）屏蔽安全报错</p><p>相信不少VS老玩家都应该知道_s的安全报错，直接在代码里写并不是一个好的方法，修改预处理器更好，当然你也可以直接屏蔽所有的警告，这里不再赘述。</p><p>调试→属性→配置属性→C/C++→预处理器→预处理器定义，添加：</p><pre><code class="prettyprint lang-c linenums">_CRT_SECURE_NO_WARNINGS;</code></pre><p>（4）写个helloworld测试一下：</p><p>BTPsender.h</p><pre><code class="prettyprint lang-c linenums">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;</code></pre><p>BTPsender.c</p><pre><code class="prettyprint lang-c linenums">#include "BTPsender.h"
int main()&#123;
  printf("1");
  return 0;
&#125;</code></pre><p>2、添��winpcap支持</p><p>（1）前往<a href="https://www.winpcap.org/" target="_blank">winpcap官网</a>下载源码包</p><p><img class="zoompic" src="http://cdn.bewindoweb.com/uploadpic/3b3641f1407ec6def9110bf583224e9e.png" style="max-width:100%;"></p><p><img class="zoompic" src="http://cdn.bewindoweb.com/uploadpic/abc08428974415f989821ebede687a66.png" style="max-width:100%;"></p><p>（2）将源码包解压到合适的位置，注意路径不要带中文</p><p><img class="zoompic" src="http://cdn.bewindoweb.com/uploadpic/eb1e2c6bf4cb96816ce84c2e12b06a7e.png" style="max-width:100%;"></p><p>（3）调试→属性→配置属性→C/C++→预处理器→预处理器定义，添加：</p><pre><code class="prettyprint lang-c linenums">HAVE_REMOTE;WPCAP;</code></pre><p><img class="zoompic" src="http://cdn.bewindoweb.com/uploadpic/401307d57ca5914488874e5079f16fec.png" style="max-width:100%;"></p><p>（4）调试→属性→配置属性→链接器→输入→附加依赖项，添加：</p><pre><code class="prettyprint lang-c linenums">ws2_32.lib;wpcap.lib;Packet.lib;</code></pre><p><img class="zoompic" src="http://cdn.bewindoweb.com/uploadpic/412230f7e657dd67057aa8dc28306064.png" style="max-width:100%;"></p><p>（5）调试→属性→VC++目录，包含目录添加<code>E:\WpdPack\Include</code>，库目录添加<code>E:\WpdPack\Lib</code>，这两个路径就是你刚才解压winpcap源码的路径。</p><p><img class="zoompic" src="http://cdn.bewindoweb.com/uploadpic/af5eea27d2e88dc38c0a7349c9db6b5b.png" style="max-width:100%;"></p><p>（6）测试一下是否引入成功：</p><p>BTPsender.h添加：</p><pre><code class="prettyprint lang-c linenums">#include &lt;pcap.h&gt;</code></pre><p>运行，发现报错，找不到sys/time.h：</p><p><img class="zoompic" src="http://cdn.bewindoweb.com/uploadpic/48e79b82c11eed76d65038b15dc02546.png" style="max-width:100%;"></p><p>我们点击这个报错进去看，发现是这几行代码：</p><p><img class="zoompic" src="http://cdn.bewindoweb.com/uploadpic/9e80f88e5ef64384f63af7a8899bb5d0.png" style="max-width:100%;"></p><p>很容易能读懂，就是没有定义WIN32这个常量，导致被识别为UNIX系统，引入了UNIX的头文件，当然找不到了。解决办法就是直接注释掉整段，强行写一个#include：</p><p><img class="zoompic" src="http://cdn.bewindoweb.com/uploadpic/462b3931fb61bcd046c79d4e7fde54e2.png" style="max-width:100%;"></p><p>保存，再次运行，成功通过编译。</p><p>3、发包测试</p><p>（1）打开windows xp虚拟机PB，网络适配器选择NAT模式，用<code>ipconfig /all</code>查看虚拟网卡MAC地址，这里是00-0C-29-86-B8-C8：</p><p><img class="zoompic" src="http://cdn.bewindoweb.com/uploadpic/7bd65e5fb11a7dd200c6061ea5daabba.png" style="max-width:100%;"></p><p>（2）回到主机PA，同样用<code>ipconfig /all</code>查看本机VMnet8的MAC地址，这里是00-50-56-C0-00-08：</p><p><img class="zoompic" src="http://cdn.bewindoweb.com/uploadpic/a69d0c6ab7d81c0233c3127ceb37cb98.png" style="max-width:100%;"></p><p>（3）构造一个以太网帧，数据字段就随便填写一个字符串，然后使用winpcap发送出去。</p><p>这里有个知识点就是以太网帧的格式，这里使用最常见的Ethernet II，有关以太网帧的比较可以参看<a href="https://blog.csdn.net/lucien_cc/article/details/9814199" target="_blank">《四种格式的以太网帧结构》</a>，以后也许会有机会自己写一篇。</p><p><img class="zoompic" src="http://cdn.bewindoweb.com/uploadpic/2c41e237cc4a8f3e371b1cd7b657da08.png" style="max-width:100%;"></p><p><span style="font-weight: bold;">FCS</span>：FCS就是目的MAC到数据之间的内容得到的校验和，一般用CRC32。这一部分是不需要自己添加的，网卡驱动会自行计算。</p><p><span style="font-weight: bold;">数据</span>：至于为什么数据最少要有46字节，简单的来说就是为了及时检测冲突，如果包小于64字节，那么对于相距很远的主机，很可能这边发送完了认为发送成功，那边冲突的信号还没传过来。我们所设计的协议包就是放在以太网帧的数据字段里面，所以这里先随便填写一个字符串，测试发送的通畅性。</p><p><span style="font-weight: bold;">类型</span>：类型字段表明这个帧到底是什么，比如常见的IP包，这里会写0x0800；ARP包，这里会写0x0806；PPPoE发现阶段为0x8863等等。这里随便填一个，填类型为IP包即可。</p><p>不难写出这样的发包程序：</p><p>BTPsender.h</p><pre><code class="prettyprint lang-c linenums">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;pcap.h&gt;
#include &lt;winsock.h&gt;

</li>
</ul>
<p>#define ETHERTYPE_IP                    0x0800 /* IP */<br>#define ERROR_GENERAL                    -1<br>#define ERROR_FINDALLDEVS_FAILURE        -2<br>#define ERROR_INTERFACES_NOT_FOUND        -3<br>#define ERROR_BAD_INPUT                    -4<br>#define ERROR_OPEN_ADAPTER_FAILURE        -5<br>#define ERROR_SENDING_FAILURE            -6<br>#define SEND_BUFSIZE                    1024<br>#define SEND_TIMES                        10000<br>#define SEND_INTVAL                        1000</p>
<p>typedef struct ETH_HEADER<br>&#123;<br>    u_char dest_mac[6];<br>    u_char src_mac[6];<br>    u_short etype;<br>&#125;ETH_HEADER;</code></pre><p>BTPsender.c</p><pre><code class="prettyprint lang-c linenums">#include "BTPsender.h"</p>
<p>int main()<br>&#123;<br>    pcap_t <em>adapter;                        /</em> 网卡句柄 <em>/<br>    char errbuf[PCAP_ERRBUF_SIZE];            /</em> 错误信息buffer <em>/<br>    ETH_HEADER eth_header;                    /</em> 以太网包头 */</p>
<pre><code>char package[] = &#123; &quot;BTP test.&amp;lt;46&quot; &#125;;        /* 测试用的字符串 */
int index;                                /* 发送buffer偏移 */
u_char sendbuf[SEND_BUFSIZE];            /* 发送buffer */

pcap_if_t *alldevs;    /* 全部网卡列表 */
pcap_if_t *d;        /* 一个网卡 */
int did;            /* 选择的网卡ID */

int i;                /* 迭代 */

/* 查找网卡 */
if (pcap_findalldevs_ex(PCAP_SRC_IF_STRING, NULL, &amp;amp;alldevs, errbuf) == -1) &#123;
    fprintf(stderr, &quot;[ERROR] pcap_findalldevs error: %s\n&quot;, errbuf);
    return ERROR_FINDALLDEVS_FAILURE;
&#125;

/* 选择网卡d */
for (d = alldevs, i = 0; d; d = d-&amp;gt;next) &#123;
    if (d-&amp;gt;description)
        printf(&quot;NO.%d: %s\n&quot;, ++i, d-&amp;gt;description);
    else
        printf(&quot;[WARN] No description available\n&quot;);
&#125;

if (i == 0) &#123;
    printf(&quot;[ERROR] No interfaces found! Make sure WinPcap is installed.\n&quot;);
    return ERROR_INTERFACES_NOT_FOUND;
&#125;

printf(&quot;[INFO] Enter the interface number (1-%d):&quot;, i);
scanf(&quot;%d&quot;, &amp;amp;did);

if (did &amp;lt; 1 || did &amp;gt; i) &#123;
    printf(&quot;[ERROR] Interface number out of range.\n&quot;);
    pcap_freealldevs(alldevs);
    return ERROR_BAD_INPUT;
&#125;

for (d = alldevs, i = 0; i &amp;lt; did - 1; d = d-&amp;gt;next, i++);

/* 打开网卡 */
if ((adapter = pcap_open_live(d-&amp;gt;name,    /* 设备名 */
                        65536,            /* 捕获数据包的长度（65536捕获所有数据包） */
                        1,                /* 混杂模式（非0表示使用混杂模式） */
                        1000,            /* 超时时间（0表示没有超时限制） */
                        errbuf            /* 错误缓存（存储错误信息） */
    )) == NULL) &#123;
    fprintf(stderr, &quot;[ERROR] Unable to open the adapter. %s is not supported by WinPcap\n&quot;);
    pcap_freealldevs(alldevs);
    return ERROR_OPEN_ADAPTER_FAILURE;
&#125;

/*目的PB的mac地址*/
eth_header.dest_mac[0] = 0x00;
eth_header.dest_mac[1] = 0x0C;
eth_header.dest_mac[2] = 0x29;
eth_header.dest_mac[3] = 0x86;
eth_header.dest_mac[4] = 0xB8;
eth_header.dest_mac[5] = 0xC8;

/*源PA的mac地址*/
eth_header.src_mac[0] = 0x00;
eth_header.src_mac[1] = 0x50;
eth_header.src_mac[2] = 0x56;
eth_header.src_mac[3] = 0xC0;
eth_header.src_mac[4] = 0x00;
eth_header.src_mac[5] = 0x08;

eth_header.etype = htons(ETHERTYPE_IP);



memcpy(sendbuf, &amp;amp;eth_header, sizeof(eth_header));
index = sizeof(eth_header);
memcpy(&amp;amp;sendbuf[index], package, sizeof(package));
index += sizeof(package);

/* 发包 */
for (i = 0; i &amp;lt; SEND_TIMES; i++) &#123;
    if (pcap_sendpacket(adapter,    /* 网卡句柄 */
                        sendbuf,    /* 要发送的帧 */
                        index        /* 帧的大小 */
        ) != 0) &#123;
        fprintf(stderr, &quot;[ERROR] Error sending the packet: %s\n&quot;, pcap_geterr(adapter));
        return ERROR_SENDING_FAILURE;
    &#125;
    printf(&quot;packet send successed!\n&quot;);
    Sleep(SEND_INTVAL);
&#125;

pcap_close(adapter);
return 0;</code></pre>
<p>}</code></pre><p>这里���注意的是，引入了#include &lt;winsock.h&gt;，并且使用了eth_header.etype = htons(ETHERTYPE_IP);的写法，我们来看看不这样做会发生什么，用wireshark抓vmnet8的包：</p><p><img class="zoompic" src="http://cdn.bewindoweb.com/uploadpic/338bebecdfbac4c21e9b44ed9cfe92ae.png" style="max-width:100%;"></p><p>被识别为了802.3的帧，长度为8，巧合的是设置的IP类型也为0x0800。没错，由于网络字节序，0x0800被存储为了0x0008，导致被识别为802.3协议。一种改法是采用类似MAC地址的那种字节数组，然而这不利于使用宏定义；还有一种就是修改宏定义，改为0x0008，但是这又不利于阅读了。所以我们最好写的时候正常写，发包的时候再利用htons（也就是host to network short）函数转换：</p><p><img class="zoompic" src="http://cdn.bewindoweb.com/uploadpic/d60918afa3cff45dcb51d1ac4f6b66e9.png" style="max-width:100%;"></p><p>还有一点值得注意的是，发送的数据包小于46字节，也没有报错。我们先来看看在虚拟机windows xp上低版本的wireshark抓到的包是什么样的：</p><p><img class="zoompic" src="http://cdn.bewindoweb.com/uploadpic/0f9ead31831a2d5ad45b9445bbf80965.png" style="max-width:100%;"></p><p>原来后面都填充了0，一共60字节（有4字节校验码没有显示），所以推测wireshark高版本不再显示这些自动填充字节了。PA发包，PB收到相同的包，说明发包成功了~</p><p>【PB收包】</p><p>1、搭建Visual Studio可用环境&nbsp;</p><p>与前面一样，项目名BTPrecver，文件BTPrecver.h / BTPrecver.c</p><p>2、添加winpcap支持&nbsp;&nbsp;<br></p><p>与前面一样。</p><p>3、支持xp</p><p>这一步的原因是因为懒得去配置windows xp下的编程环境了，我们直接在windows 8上采用vs2013来编写和编译，然后把生成的exe发到虚拟机运行即可，因此需要让程序支持xp。</p><p>（1）调试→属性→配置属性→常规→平台工具集，选择Visual Studio 2013 - Windows Xp（v120_xp）</p><p><img class="zoompic" src="http://cdn.bewindoweb.com/uploadpic/6f401b617abb9b73b1aa63fa516e191d.png" style="max-width:100%;"></p><p>（2）调试→属性→配置属性→链接器→系统→子系统，选择窗口(/SUBSYSTEM:WINDOWS)，同时注意一下所需最低版本是不是5.01：</p><p><img class="zoompic" src="http://cdn.bewindoweb.com/uploadpic/154f723e70e767ffa64d459025064a70.png" style="max-width:100%;"></p><p>（3）调试→属性→配置属性→链接器→命令行，添加：</p><pre><code class="prettyprint lang-c linenums">/SUBSYSTEM:CONSOLE,"5.01"</code></pre><p></p><p></p><p><img class="zoompic" src="http://cdn.bewindoweb.com/uploadpic/ab5bf81c17a75c44e329d53d4f1db6ca.png" style="max-width:100%;"></p><p>这一步非常重要，否则你的程序跑在windows xp上就会提示“不是有效的win32应用程序”。</p><p>4、使用静态编译</p><p>这样就不需要动态链接库了，把所有依赖都打包进exe：</p><p>调试→属性→配置属性→C/C++→代码生成→运行库，选择多线程(/MT)：</p><p><img class="zoompic" src="http://cdn.bewindoweb.com/uploadpic/66c5d745d7a2082d5781a4db65f85306.png" style="max-width:100%;"></p><p>5、收包测试</p><p>BTPrecver.h</p><pre><code class="prettyprint lang-c linenums">#include &lt;stdio.h&gt;<br>#include &lt;stdlib.h&gt;<br>#include &lt;pcap.h&gt;<br>#include &lt;winsock.h&gt;</p>
<p>#define ERROR_GENERAL                    -1<br>#define ERROR_FINDALLDEVS_FAILURE        -2<br>#define ERROR_INTERFACES_NOT_FOUND        -3<br>#define ERROR_BAD_INPUT                    -4<br>#define ERROR_OPEN_ADAPTER_FAILURE        -5<br>#define ERROR_SENDING_FAILURE            -6<br>#define ERROR_INVALID_DATALINK_TYPE        -7<br>#define ERROR_COMPILE_FILTER_FALIURE    -8<br>#define ERROR_SET_FILTER_FALIURE        -9</p>
<p>typedef struct ETH_HEADER<br>&#123;<br>    u_char dest_mac[6];<br>    u_char src_mac[6];<br>    u_short etype;<br>&#125;ETH_HEADER;</p>
<p>void packet_handler(u_char <em>param, const struct pcap_pkthdr *header, const u_char *pkt_data);/</em> 抓包回调函数 */<br>void format_mac(LPSTR lpHWAddrStr, const unsigned char <em>HWAddr);/</em> mac地址格式化函数 */</code></pre><p>BTPrecver.c<br></p><pre><code class="prettyprint lang-c linenums">#include "BTPrecver.h"</p>
<p>int main()<br>&#123;<br>    pcap_t <em>adapter;                /</em> 网卡句柄 <em>/<br>    char errbuf[PCAP_ERRBUF_SIZE];    /</em> 错误信息buffer <em>/<br>    u_int netmask;                    /</em> 掩码信息 <em>/<br>    char packet_filter[] = “ether src 00:50:56:C0:00:08 and ether dst 00:0C:29:86:B8:C8”; /</em> 过滤规则 <em>/<br>    struct bpf_program fcode;        /</em> 存储编译好的过滤码 */</p>
<pre><code>pcap_if_t *alldevs;    /* 全部网卡列表 */
pcap_if_t *d;        /* 一个网卡 */
int did;            /* 选择的网卡ID */

int i = 0;            /* 迭代 */

/*查找网卡*/
if (pcap_findalldevs_ex(PCAP_SRC_IF_STRING, NULL, &amp;amp;alldevs, errbuf) == -1) &#123;
    fprintf(stderr, &quot;[ERROR] pcap_findalldevs error: %s\n&quot;, errbuf);
    return ERROR_FINDALLDEVS_FAILURE;
&#125;

/* 选择网卡d */
for (d = alldevs, i = 0; d; d = d-&amp;gt;next) &#123;
    if (d-&amp;gt;description)
        printf(&quot;NO.%d: %s\n&quot;, ++i, d-&amp;gt;description);
    else
        printf(&quot;[WARN] No description available\n&quot;);
&#125;

if (i == 0) &#123;
    printf(&quot;[ERROR] No interfaces found! Make sure WinPcap is installed.\n&quot;);
    return ERROR_INTERFACES_NOT_FOUND;
&#125;

printf(&quot;[INFO] Enter the interface number (1-%d):&quot;, i);
scanf(&quot;%d&quot;, &amp;amp;did);

if (did &amp;lt; 1 || did &amp;gt; i) &#123;
    printf(&quot;[ERROR] Interface number out of range.\n&quot;);
    pcap_freealldevs(alldevs);
    return ERROR_BAD_INPUT;
&#125;

for (d = alldevs, i = 0; i &amp;lt; did - 1; d = d-&amp;gt;next, i++);

/* 打开网卡 */
if ((adapter = pcap_open_live(d-&amp;gt;name,    /* 设备名 */
                              65536,    /* 捕获数据包的长度（65536捕获所有数据包） */
                              1,        /* 混杂模式（非0表示使用混杂模式） */
                              1000,        /* 超时时间（0表示没有超时限制） */
                              errbuf    /* 错误缓存（存储错误信息） */
    )) == NULL) &#123;
    fprintf(stderr, &quot;[ERROR] Unable to open the adapter. %s is not supported by WinPcap\n&quot;);
    pcap_freealldevs(alldevs);
    return ERROR_OPEN_ADAPTER_FAILURE;
&#125;

/* 检查链路层类型 */
if (pcap_datalink(adapter) != DLT_EN10MB) /* DLT_EN10MB指10Mb以太网 */
&#123;
    fprintf(stderr, &quot;[ERROR] This program works only on Ethernet networks.\n&quot;);
    pcap_freealldevs(alldevs);
    return ERROR_INVALID_DATALINK_TYPE;
&#125;

/* 检查地址类型 */
if (d-&amp;gt;addresses != NULL) /* 如果有IP地址 */
    netmask = ((struct sockaddr_in *)(d-&amp;gt;addresses-&amp;gt;netmask))-&amp;gt;sin_addr.S_un.S_addr; /* 使用第一个掩码 */
else /* 如果没有IP地址，说明是C类网络（局域网） */
    netmask = 0xffffff;    /* 掩码设置为255.255.255.0 */


/* 编译过滤器 */
if (pcap_compile(adapter, &amp;amp;fcode, packet_filter, 1, netmask) &amp;lt; 0) /* 1表示自动进行优化 */
&#123;
    fprintf(stderr, &quot;[ERROR] Unable to compile the packet filter. Check the syntax.\n&quot;);
    pcap_freealldevs(alldevs);
    return ERROR_COMPILE_FILTER_FALIURE;
&#125;

/* 应用过滤器 */
if (pcap_setfilter(adapter, &amp;amp;fcode)&amp;lt;0)
&#123;
    fprintf(stderr, &quot;[ERROR] Error setting the filter.\n&quot;);
    pcap_freealldevs(alldevs);
    return ERROR_SET_FILTER_FALIURE;
&#125;

/* 开始抓包 */
printf(&quot;listening on %s...\n&quot;, d-&amp;gt;description);
pcap_freealldevs(alldevs);
pcap_loop(adapter, 0, packet_handler, NULL);

return 0;</code></pre>
<p>}</p>
<p>/* 抓包回调函数 <em>/<br>void packet_handler(u_char <em>param, const struct pcap_pkthdr *header, const u_char *pkt_data)<br>{<br>    time_t local_tv_sec;    /</em> 时间戳 */<br>    struct tm *ltime;        /</em> 本地时间 <em>/<br>    char timestr[16];        /</em> 格式化后的本地时间 <em>/<br>    ETH_HEADER <em>eth_header;    /</em> 以太网帧包头 <em>/<br>    char str_mac[50];        /</em> 源MAC地址 <em>/<br>    char dest_mac[50];        /</em> 目的MAC地址 */<br>    char *data;        /</em> 数据 */</p>
<pre><code>/* 没有使用param  */
(VOID)(param);

/* 格式化当前时间 */
local_tv_sec = header-&amp;gt;ts.tv_sec;
ltime = localtime(&amp;amp;local_tv_sec);
strftime(timestr, sizeof timestr, &quot;%H:%M:%S&quot;, ltime);

/* 解析以太网帧 */
eth_header = (ETH_HEADER *)pkt_data;
format_mac(str_mac, eth_header-&amp;gt;src_mac);
format_mac(dest_mac, eth_header-&amp;gt;dest_mac);

printf(&quot;[ %s.%.6d ] receive package    \nlength=\t%d   \neth type=\t0x%x    \nsrc mac=\t%s    \ndest mac=\t%s\n&quot;, 
                    timestr, header-&amp;gt;ts.tv_usec, header-&amp;gt;len, ntohs(eth_header-&amp;gt;etype), str_mac, dest_mac);

/* 解析数据域 */
data = (char *)(pkt_data + 14);
printf(&quot;data= \t%s\n&quot;, data);</code></pre>
<p>}</p>
<p>void format_mac(char* lpHWAddrStr, const unsigned char *HWAddr)<br>{<br>    int i;<br>    short temp;<br>    char szStr[3];</p>
<pre><code>strcpy(lpHWAddrStr, &quot;&quot;);
for (i = 0; i&amp;lt;6; ++i)
&#123;
    temp = (short)(*(HWAddr + i));
    _itoa(temp, szStr, 16);
    if (strlen(szStr) == 1)
        strcat(lpHWAddrStr, &quot;0&quot;);
    strcat(lpHWAddrStr, szStr);
    if (i&amp;lt;5)
        strcat(lpHWAddrStr, &quot;:&quot;); 
&#125;</code></pre>
<p>}</code></pre><p>然后���生成的EXE文件复制到虚拟机运行：</p><p><img class="zoompic" src="http://cdn.bewindoweb.com/uploadpic/5bd149ce2667188f9835a2a5e5083af5.png" style="max-width:100%;"></p><p>这里值得注意的有：<br>（1）解包的时候要使用ntohs(eth_header-&gt;etype)来把字节序展示为正常的字节序</p><p>（2）过滤器的写法可以参考<a href="https://blog.csdn.net/u012877472/article/details/49824347" target="_blank">《WinPcap笔记（6）：过滤数据包》</a></p><p>PA端运行发包程序，然后PB端运行收包程序，最后的结果：</p><p><img class="zoompic" src="http://cdn.bewindoweb.com/uploadpic/226f2a87781a8e79c30ce7ff5750a77e.png" style="max-width:100%;"></p><p>到这里，已经可以学会如何设计通信协议、以及使用winpcap进行发包收包了，完整的工程文件可以<a href="https://pan.baidu.com/s/1rOlkkg0xzL6yZi5Y0yxTZw" target="_blank">在这里下载</a>（密码：qdnu）。那么接下来应用我们自己的通信协议试一试，如果有兴趣请继续浏览<a href="http://www.bewindoweb.com/article.php?id=212" target="_blank">《用winpcap测试自己的通信协议（二）》</a>。</p><h1>参考资料</h1><p>1、<a href="https://blog.csdn.net/zhushuai1221/article/details/52524066" target="_blank">《自己设计系统之间的通信协议》</a></p><p>2、<a href="https://blog.csdn.net/dfsae/article/details/78965235" target="_blank">《如何自定义一个通信协议》</a></p><p>3、<a href="https://blog.csdn.net/lucien_cc/article/details/9814199" target="_blank">《四种格式的以太网帧结构》</a></p><p>4、<a href="https://www.cnblogs.com/reddusty/p/4972693.html" target="_blank">《c语言中网络字节序和主机字节序的转换》</a></p><p>5、<a href="https://blog.csdn.net/qsycn/article/details/4459058" target="_blank">《WinPcap基础知识（第八课：发送数据包）》</a></p><p>6、<a href="https://blog.csdn.net/guozhongwei1/article/details/52663083" target="_blank">《关于以太网(Ethernet II)这个网络的个人理解以及应用（1）》</a></p><p>7、<a href="http://blog.sina.com.cn/s/blog_5373ba7b0100rulu.html" target="_blank">《以太网帧 类型字段及值》</a></p><p>8、<a href="https://blog.csdn.net/dubuzherui/article/details/43227359" target="_blank">《WinPcap发送接收裸包（一）》</a></p><p>9、<a href="https://blog.csdn.net/dubuzherui/article/details/43228841" target="_blank">《WinPcap发送接收裸包（二）》</a></p><p>10、<a href="https://blog.csdn.net/jeffery_gong/article/details/51271979" target="_blank">《学习整理——以太帧、ip帧、udp/tcp帧、http报文结构》</a></p><p>11、<a href="https://blog.csdn.net/violetfeeling/article/details/4469907" target="_blank">《以太网原理 最大帧长 最小帧长》</a></p><p>12、<a href="https://blog.csdn.net/microtong/article/details/3030039" target="_blank">《ARP欺骗源码（基于WinPcap实现）》</a></p><p>13、<a href="https://blog.csdn.net/liuyez123/article/details/51497104" target="_blank">《怎么让VS2015编写的程序在XP中顺利运行》</a></p><p>14、<a href="https://blog.csdn.net/u012877472/article/details/49824347" target="_blank">《WinPcap笔记（6）：过滤数据包》</a></p><p><br></p>                </div></p>
	
  </div>
  
  
  <br><br>
  <div style="height:60px;border:none;border-top:1px solid #000;"></div>  
  <div style="margin-left: 125px;">
    <div style="float: left; width: 200px; height: 200px;">
        <img class="adv" style="width: 100%; height: 100%; border: solid 1px #ddd;" src="https://pic4.zhimg.com/80/v2-6f4153925b20af12b17837b531302695_720w.jpeg">
    </div>
    <div style="float: left; margin-left: 35px;">
        <div style="font-size: 28px; margin-bottom: 12px;margin-left: 4px;">关注我的公众号</div>
        <small style="font-size: 1.2em;">
            →「技术干货」每日推送<br><br>
            →「免费资料」随时领取<br><br>
            →「签到活动」每周福利<br><br>
        </small>
    </div>
    <div style="clear: both;"></div>
</div>
  
  
  
  <div>
  
  <div class="post-note note-warning copyright" style="margin-top: 42px">
    <p><span style="font-weight: bold;">作者：</span><a target="_blank" rel="nofollow noopener noreferrer" href="http://tanqingbo.cn/about">谭庆波</a></p>
    <p><span style="font-weight: bold;">文章链接：</span><a target="_blank" rel="nofollow noopener noreferrer" href="http://tanqingbo.cn/2019/10/06/%E7%94%A8winpcap%E6%B5%8B%E8%AF%95%E8%87%AA%E5%B7%B1%E7%9A%84%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE%EF%BC%88%E4%B8%80%EF%BC%89/">http://tanqingbo.cn/2019/10/06/%E7%94%A8winpcap%E6%B5%8B%E8%AF%95%E8%87%AA%E5%B7%B1%E7%9A%84%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE%EF%BC%88%E4%B8%80%EF%BC%89/</a></p>
    <p><span style="font-weight: bold;">版权声明：</span>本博客所有文章除特别声明外，均采用<a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">CC BY-NC-SA 4.0 协议</a>。转载请注明出处！</p>
  </div>
  
  </div>
</article>
<div class="nav">
  
  <div class="nav-item-prev">
    <a href="/2019/10/06/特征归一化特性及其数学原理推导/" class="nav-link">
      <i class="iconfont icon-left nav-prev-icon"></i>
      <div>
        <div class="nav-label">上一篇</div>
        
        <div class="nav-title">特征归一化特性及其数学原理推导 </div>
        
      </div>
    </a>
  </div>
  
  
  <div class="nav-item-next">
    <a href="/2019/10/06/百度IoT：MQTT Broker架构设计/" class="nav-link">
      <div>
        <div class="nav-label">下一篇</div>
        
        <div class="nav-title">百度IoT：MQTT Broker架构设计 </div>
        
      </div>
      <i class="iconfont icon-right nav-next-icon"></i>
    </a>
  </div>
  
</div>

<div class="card card-content toc-card" id="mobiletoc">
  <div class="toc-header"><i class="iconfont icon-menu" style="padding-right: 2px;"></i>目录</div>
<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">一、通信协议的设计</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">二、使用winpcap进行简单收发包测试</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-text">实验工具和平台</span></a></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-text">实验拓扑</span></a></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-text">收发包基础环境搭建</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">参考资料</span></a></li></ol>
</div></main>
          <aside class="left-column">
            
            <div class="card card-author">
              
<img src="/img/logo.jpg" class="author-img">

<p class="author-name">谭庆波</p>
<p class="author-description">designed by Tan Qing Bo</p>
<div class="author-message">
  <a class="author-posts-count" href="/archives">
    <span>319</span>
    <span>文章</span>
  </a>
  <a class="author-categories-count" href="/categories">
    <span>14</span>
    <span>分类</span>
  </a>
  <a class="author-tags-count" href="/tags">
    <span>34</span>
    <span>标签</span>
  </a>
</div>

            </div>
            
            <div class="sticky-tablet">
  
  
  <article class="display-when-two-columns spacer">
    <div class="card card-content toc-card">
      <div class="toc-header"><i class="iconfont icon-menu" style="padding-right: 2px;"></i>目录</div>
<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">一、通信协议的设计</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">二、使用winpcap进行简单收发包测试</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-text">实验工具和平台</span></a></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-text">实验拓扑</span></a></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-text">收发包基础环境搭建</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">参考资料</span></a></li></ol>
    </div>
  </article>
  
  
  <article class="card card-content categories-widget">
    <div class="categories-card">
  <div class="categories-header"><i class="iconfont icon-fenlei" style="padding-right: 2px;"></i>分类</div>
  <div class="categories-list">
    
      <a href="/categories/转载">
        <div class="categories-list-item">
          转载
          <span class="categories-list-item-badge">117</span>
        </div>
      </a>
    
      <a href="/categories/漂来漂去">
        <div class="categories-list-item">
          漂来漂去
          <span class="categories-list-item-badge">40</span>
        </div>
      </a>
    
      <a href="/categories/机器学习">
        <div class="categories-list-item">
          机器学习
          <span class="categories-list-item-badge">37</span>
        </div>
      </a>
    
      <a href="/categories/C语言">
        <div class="categories-list-item">
          C语言
          <span class="categories-list-item-badge">4</span>
        </div>
      </a>
    
      <a href="/categories/资源分享">
        <div class="categories-list-item">
          资源分享
          <span class="categories-list-item-badge">18</span>
        </div>
      </a>
    
      <a href="/categories/图像处理">
        <div class="categories-list-item">
          图像处理
          <span class="categories-list-item-badge">15</span>
        </div>
      </a>
    
      <a href="/categories/技术博客">
        <div class="categories-list-item">
          技术博客
          <span class="categories-list-item-badge">38</span>
        </div>
      </a>
    
      <a href="/categories/Linux">
        <div class="categories-list-item">
          Linux
          <span class="categories-list-item-badge">5</span>
        </div>
      </a>
    
      <a href="/categories/Java">
        <div class="categories-list-item">
          Java
          <span class="categories-list-item-badge">23</span>
        </div>
      </a>
    
      <a href="/categories/大话设计模式">
        <div class="categories-list-item">
          大话设计模式
          <span class="categories-list-item-badge">5</span>
        </div>
      </a>
    
      <a href="/categories/东搞西搞">
        <div class="categories-list-item">
          东搞西搞
          <span class="categories-list-item-badge">10</span>
        </div>
      </a>
    
      <a href="/categories/设计模式">
        <div class="categories-list-item">
          设计模式
          <span class="categories-list-item-badge">1</span>
        </div>
      </a>
    
      <a href="/categories/网络原理">
        <div class="categories-list-item">
          网络原理
          <span class="categories-list-item-badge">4</span>
        </div>
      </a>
    
      <a href="/categories/操作系统">
        <div class="categories-list-item">
          操作系统
          <span class="categories-list-item-badge">2</span>
        </div>
      </a>
    
  </div>
</div>
  </article>
  
  <article class="card card-content tags-widget">
    <div class="tags-card">
  <div class="tags-header"><i class="iconfont icon-biaoqian" style="padding-right: 2px;"></i>热门标签</div>
  <div class="tags-list">
    
    <a href="\tags\Java" title="Java"><div class="tags-list-item">Java</div></a>
    
    <a href="\tags\算法" title="算法"><div class="tags-list-item">算法</div></a>
    
    <a href="\tags\java" title="java"><div class="tags-list-item">java</div></a>
    
    <a href="\tags\框架" title="框架"><div class="tags-list-item">框架</div></a>
    
    <a href="\tags\面试" title="面试"><div class="tags-list-item">面试</div></a>
    
    <a href="\tags\网络" title="网络"><div class="tags-list-item">网络</div></a>
    
    <a href="\tags\排序" title="排序"><div class="tags-list-item">排序</div></a>
    
    <a href="\tags\项目" title="项目"><div class="tags-list-item">项目</div></a>
    
    <a href="\tags\hibernate" title="hibernate"><div class="tags-list-item">hibernate</div></a>
    
    <a href="\tags\操作系统" title="操作系统"><div class="tags-list-item">操作系统</div></a>
    
    <a href="\tags\Sping" title="Sping"><div class="tags-list-item">Sping</div></a>
    
    <a href="\tags\数据结构" title="数据结构"><div class="tags-list-item">数据结构</div></a>
    
    <a href="\tags\博客" title="博客"><div class="tags-list-item">博客</div></a>
    
    <a href="\tags\Python" title="Python"><div class="tags-list-item">Python</div></a>
    
    <a href="\tags\Linux" title="Linux"><div class="tags-list-item">Linux</div></a>
    
    <a href="\tags\技术" title="技术"><div class="tags-list-item">技术</div></a>
    
  </div>
</div>
  </article>
  
  
</div>
          </aside>
          <aside class="right-column">
            <div class="sticky-widescreen">


<article class="card card-content toc-card">
<div style="">
    <div style="float: left; width: 125px; height: 125px;">
        <img class="adv" style="width: 100%; height: 100%; border: solid 1px #ddd;" src="https://pic4.zhimg.com/80/v2-6f4153925b20af12b17837b531302695_720w.jpeg">
    </div>
    <div style="float: left; margin-left: 17px; margin-top: 12px;">
        <div style="font-size: 18px; margin-bottom: 12px;margin-left: 4px;">关注我的公众号</div>
        <small style="font-size: 0.8em;">
            →「技术干货」每日推送<br>
            →「免费资料」随时领取<br>
            →「签到活动」每周福利<br>
        </small>
    </div>
    <div style="clear: both;"></div>
	<div style="font-size: 0.8em; margin: 15px 0 10px 0;">
    <a href="" target="_blank" style="color:orange;font-size: 14px;" rel="noopener noreferrer">扫描上方二维码，关注我的公众号</a>
    <br>
    <div style="height: 8px;"></div>
    更多干货，等你来看，我在微信上等你！
</div>
</div>
</article>


<article class="card card-content toc-card">
<div class="xingqiu-img"><img src="https://pic2.zhimg.com/80/v2-441b28a9a0e7b22d12baaef93db56e4b_720w.png"></div>
<div style="clear: both;"></div>

<div style="font-size: 0.8em; margin: 15px 0 10px 0;">
	<strong><span style="caret-color: red;font-size: 15px;color: rgb(77, 168, 238);">扫码加入星球你将收获：</span></strong>
    <div style="height: 8px;"></div>
    1、主流互联网中找不到的副业赚钱方法，帮助你闷声赚钱；
	<div style="height: 5px;"></div>
	2、分享我的投资理财方法以及互联网中各种流量陷阱和套路；
	<div style="height: 5px;"></div>
	3、无限次向我提问，咨询成长方法、求学困惑、副业赚钱等问题。
</div>
</article>


  
  
  <article class="card card-content toc-card">
    <div class="toc-header"><i class="iconfont icon-menu" style="padding-right: 2px;"></i>目录</div>
<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">一、通信协议的设计</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">二、使用winpcap进行简单收发包测试</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-text">实验工具和平台</span></a></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-text">实验拓扑</span></a></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-text">收发包基础环境搭建</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">参考资料</span></a></li></ol>
  </article>
  
  
  <article class="card card-content">
    <div class="recent-posts-card">
  <div class="recent-posts-header"><i class="iconfont icon-wenzhang_huaban" style="padding-right: 2px;"></i>最近文章</div>
  <div class="recent-posts-list">
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2020-11-09</div>
        <a href="/2020/11/09/哪本书适合推荐给 Java 初学者？/"><div class="recent-posts-item-content">哪本书适合推荐给 Java 初学者？</div></a>
      </div>
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2020-10-29</div>
        <a href="/2020/10/29/历年微软面试中出现的leetcode算法题/"><div class="recent-posts-item-content">历年微软面试中出现的leetcode算法题</div></a>
      </div>
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2020-10-22</div>
        <a href="/2020/10/22/推荐两本书/"><div class="recent-posts-item-content">推荐两本书</div></a>
      </div>
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2020-10-14</div>
        <a href="/2020/10/14/如何学习大数据模式？/"><div class="recent-posts-item-content">如何学习设计模式？</div></a>
      </div>
    
  </div>
</div>
  </article>

  
  
  
</div>
          </aside>
        </div>
      </div>
    </div>
  </div>
  
  <footer class="footer">
  <div class="footer-container">
    <div>
      <div class="footer-dsc">
        <span>Copyright ©
          
          2020 -
          
          2020
        </span>
        &nbsp;
        <a href="/" class="footer-link">谭庆波的博客 </a>
      </div>
    </div>

    
    <div class="footer-dsc">
      
      Powered by
      <a href="https://hexo.io/" class="footer-link" target="_blank" rel="nofollow noopener noreferrer">&nbsp;Hexo </a>
      
      
      <span>&nbsp;|&nbsp;</span>
      
      
      Theme -
      <a href="https://github.com/theme-kaze" class="footer-link" target="_blank"
        rel="nofollow noopener noreferrer">&nbsp;Kaze</a>
      
    </div>
    
    
    
    
      <div class="footer-dsc">
        
        本站总访问量<span id="busuanzi_value_site_pv"></span>次
        
        
        <span>&nbsp;|&nbsp;</span>
        
        
        本站总访客数<span id="busuanzi_value_site_uv"></span>次
        
      </div>
      
    
</footer>
  <a role="button" id="scrollbutton" class="basebutton" >
  <i class="iconfont icon-arrowleft button-icon"></i>
</a>
<a role="button" id="menubutton" class="basebutton">
  <i class="iconfont icon-menu button-icon"></i>
</a>
<a role="button" id="popbutton" class="basebutton">
  <i class="iconfont icon-expand button-icon"></i>
</a>
<a role="button" id="darkbutton" class="basebutton darkwidget">
  <i class="iconfont icon-weather button-icon"></i>
</a>
<a role="button" id="searchbutton" class="basebutton searchwidget">
  <i class="iconfont icon-search button-icon"></i>
</a>

  
  
  

  
  
  <script>
  var addImgLayout = function () {
    var img = document.querySelectorAll('.post-content img');
    var i;
    for (i = 0; i < img.length; i++) {
      var wrapper = document.createElement('a');
      wrapper.setAttribute('data-fslightbox', 'gallery');
      wrapper.setAttribute('href', img[i].getAttribute('data-src'));
      wrapper.style.cssText = 'width: 100%; display: flex; justify-content: center;';
      img[i].before(wrapper);
      wrapper.append(img[i]);
    }
    refreshFsLightbox();
  }
</script>
<script>loadScript("//cdn.jsdelivr.net/npm/fslightbox@3.1.0/index.min.js", addImgLayout)</script>
  
  
  
<script src="/js/main.js"></script>

  
  <script>loadScript("/js/lib/busuanzi.min.js")</script>
  
  
  <script>
    var addLazyload = function () {
      var observer = lozad('.lozad', {
        load: function (el) {
          el.srcset = el.getAttribute('data-src');
        },
        loaded: function (el) {
          el.classList.add('loaded');
        }
      });
      observer.observe();
    }
  </script>
  <script>loadScript("/js/lib/lozad.min.js", addLazyload)</script>
  
  
  <script>
    var googleAnalytics = function() {
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-178024758-1');
    }
  </script>
  <script>loadScript("https://www.googletagmanager.com/gtag/js?id=" + "UA-178024758-1", googleAnalytics)</script>
  
</body>

</html>